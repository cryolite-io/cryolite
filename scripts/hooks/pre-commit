#!/bin/bash
# Pre-commit hook for CRYOLITE
# Runs: code formatting, tests with coverage check, dependency check, and SonarCloud analysis
# Uses Makefile for centralized command management
# This hook ensures code quality before every commit

set -e

echo "ğŸ” Running pre-commit checks..."

# Load environment variables from .env
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

# Run full verification checks via Makefile
# This includes: format + test + coverage + dependency-check + quality (SonarCloud)
make verify-with-quality

# Add any files that were formatted by Spotless to the commit
if ! git diff --quiet; then
  echo "ğŸ“ Adding formatted files to the commit..."
  git add -u
fi

echo "âœ… All pre-commit checks passed!"

